<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Donatcal Vue version</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body>
  <div class="container-fluid bg-success">
    <div class="p-5 bg-success text-white text-center">
      <h1 class="display-1">Donatcal with Vue</h1>
      <p>積分制計算器，爲目標而戰！</p>
    </div>
  </div>

  <div id="app" class="container-fluid">
    <div class="shadow row bg-secondary text-light text-center">
      <div class="col-md-6">
        <h2>目標分數：{{target}}</h2>
      </div>
      <div class="col-md-6">
        <h2>當前分數：{{score}}</h2>
      </div>
    </div>
    <div class="container">
      <div class="row mt-4">
        <!-- row: seprate with score table -->
        <!-- col-md-4: seprate with chart canvas -->
        <div class="col-md-4"> 
          <!-- initial form box row: seprate with outside-form space -->
          <div id="initFormBox" class="shadow-lg rounded row bg-light">
            <!-- collapse btn col -->
            <div class="row py-2">
              <div class="col-6">
                <button id="initBtn" type="button" class="shadow-sm btn rounded" data-bs-toggle="collapse" data-bs-target="#initForm">初始設定</button>
              </div>
            </div>

            <section id="initForm" class="collapse show"> 
              <div class="row mb-3">
                <!-- row: seprate with submit btn -->
                <div class="col-6">
                    <label for="playersNum" class="form-label">選擇人數:</label>
                    <select class="form-select" :disabled="!initActive" v-model="playersNum" name="playersNum" id="playersNum" placeholder="">
                      
                        <option v-for="player in players" :value="player.id"> {{player.id}} </option>

                    </select> 
                  <!-- playersNum selection END  -->
                </div>
                <!-- col-6 END -->
                <!-- input target -->
                <div class="col-6">
                    <label for="tgip" class="form-label">請輸入目標值:</label>
                    <input type="number" :disabled="!initActive" v-model="target" class="form-control" name="tgip" id="tgip" pattern="[0-9]*" aria-describedby="tgipHelp" placeholder="">
                    <small id="tgipHelp" class="form-text text-muted">分數達到目標值將結束流程</small>
                </div>
              </div>

              <div class="row">
                <div class="d-grid">
                  <button type="submit" class="btn btn-primary mb-2" @click="initSubmit" :disabled="!initActive">提交</button>
                </div>
              </div>
              <!-- Initial Form END -->
            </section>
          </div>

          <!-- scip box START: -->
          <div id="scoreInputBox" class="shadow-lg rounded row bg-light mt-3">
            <!-- collapse btn col -->
            <div class="row py-2">
              <div class="col-6">
                <button id="scipBtn" type="button" class="shadow-sm btn rounded" data-bs-toggle="collapse" data-bs-target="#scip">錄入分數</button>
              </div>
            </div>

            <section id="scip" class="collapse">
              <div id="iterableScoreForm" >
                <template v-if="initActive==false">
                  <!-- Game Count area -->
                  <div id="gameCountArea" class="row">
                    <div class="text-center">
                      <h5>第 {{game}} 局</h5>
                    </div>
                  </div>
                  <div v-for="player in players" :key="player.id" class="row mb-3">

                      <label :for="'g'+game+'-'+player.name" class="col-8 col-form-label text" >{{player.name}}</label>
                      <div class="col-4">
                        <input type="number" class="form-control" :id="'g'+game+'-'+player.name" v-model="player.currentScore" pattern="[0-9]*">
                      </div>
                      <!-- iteration END -->

                  </div>
                </template>
              </div>

              <div class="row">
                <div class="d-grid">
                  <button type="submit" @click="scoreSubmit" :disabled="initActive" class="btn btn-primary mb-2">錄入</button>
                </div>
              </div>
            </section>
          </div>
        </div>
        <div class="col-md-8">
          <p>8.Chart.js</p>
          <canvas id="lineChart" style="width:100%"></canvas>
        </div>
      </div>
      <!-- row: score table BEGIN -->
      <div class="row bg-primary mt-1">
        <div class="col bg-primary ">
          Table
          <table class="table">
            <thead>
              <tr>
                <th></th>
                <th></th>
                <th></th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td scope="row"></td>
                <td></td>
                <td></td>
              </tr>
              <tr>
                <td scope="row"></td>
                <td></td>
                <td></td>
              </tr>
            </tbody>
          </table>
          
        </div>
      </div>
    </div>
  </div>

  <script src="https://unpkg.com/vue@next"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>
  
  <script>
    const app = Vue.createApp({
      data() {
        return {
          playersNum:2,
          score:0,
          target: 100,
          initActive:true,
          game:1,
          // We have a maximum 8 players, generating players default dataset:
          players: [
            {
              id:1,
              name:'player-1',
              borderColor: 'red',
              score: [],
              currentScore: 0,
          },
            {
              id:2,
              name:'player-2',
              borderColor: 'red',
              score: [],
              currentScore: 0,
          },
            {
              id:3,
              name:'player-3',
              borderColor: 'red',
              score: [],
              currentScore: 0,
          },
            {
              id:4,
              name:'player-4',
              borderColor: 'red',
              score: [],
              currentScore: 0,
          },
            {
              id:5,
              name:'player-5',
              borderColor: 'red',
              score: [],
              currentScore: 0,
          },
            {
              id:6,
              name:'player-6',
              borderColor: 'red',
              score: [],
              currentScore: 0,
          },
            {
              id:7,
              name:'player-7',
              borderColor: 'red',
              score: [],
              currentScore: 0,
          },
            {
              id:8,
              name:'player-8',
              borderColor: 'red',
              score: [],
              currentScore: 0,
          }],
          
        
      };
    },

    methods: {
      initSubmit(){
        this.players = this.players.slice(0,this.playersNum);
        document.querySelector('#initBtn').click();
        this.initActive = false;  
        setTimeout(() => {
          document.querySelector('#scipBtn').click();
        }, 200);
      },
    
      scoreSubmit(){






        // clear current score, go to next loop
        this.players.forEach(player => {
          const scoreTemplate = {'game':this.game,'score':player.currentScore};
          player.score.push(scoreTemplate);
          
          player.currentScore = 0;          
        });

        this.game++;
      }



    },
    }).mount('#app')
  </script>
</body>
</html>